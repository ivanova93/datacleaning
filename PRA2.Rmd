---
title: 'Tipología y ciclo de vida de los datos: PRA2 - Limpieza y análisis de datos'
author: "Autor: Giovanny Caluña y Ivan Ovalle"
date: "Mayo 2021"
output:
  pdf_document:
    highlight: zenburn
    toc: yes
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
    includes:
      in_header: PRA2-header.html
  word_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Detalles de la actividad
## Descripción
En esta práctica se elabora un caso práctico orientado a aprender a identificar los datos 
relevantes para un proyecto analítico y usar las herramientas de integración, limpieza, validación 
y análisis de las mismas.

## Objetivos
Los objetivos que se persiguen mediante el desarrollo de esta actividad práctica son los
siguientes:
- Aprender a aplicar los conocimientos adquiridos y su capacidad de resolución de problemas en entornos nuevos o poco conocidos dentro de contextos más amplios o multidisciplinares.
- Saber identificar los datos relevantes y los tratamientos necesarios (integración, limpieza y validación) para llevar a cabo un proyecto analítico.
Aprender a analizar los datos adecuadamente para abordar la información contenida en los datos.
- Identificar la mejor representación de los resultados para aportar conclusiones sobre el problema planteado en el proceso analítico.
- Actuar con los principios éticos y legales relacionados con la manipulación de datos en función del ámbito de aplicación.
- Desarrollar las habilidades de aprendizaje que permita continuar estudiando de un modo que tendrá que ser en gran medida autodirigido o autónomo.
- Desarrollar la capacidad de búsqueda, gestión y uso de información y recursos en el ámbito de la ciencia de datos.



## Competencias
Las competencias que se desarrollan son:

- Capacidad de analizar un problema en el nivel de abstracción adecuado a cada situación y aplicar las habilidades y conocimientos adquiridos para abordarlo y resolverlo.
- Capacidad para aplicar las técnicas específicas de tratamiento de datos (integración, transformación, limpieza y validación) para su posterior análisis.


# Desarrollo

## Descripción del dataset
Para el desarrollo de este proyecto se seleccionó el data set llamado: Titanic: Machine Learning. Obtenido de: (https://www.kaggle.com/c/titanic). El data set cuenta con la informacion de diferentes tripulantes que estuvieron en el Titanic el dia de su hundimineto. 
El data set cuenta con 12 atributos que ayudan a describir a cada pasajero:
- PassengerID: Id del pasajero registrado.
- Survived: Si el pasajero sobrevivió o no al incidente(0 = No, 1 = Si).
- Pclass: Clase del ticket abordo del Titanic. Ej: 1,2 o 3.
- Name: Nombre del pasajero.
- Sex: Genero del pasajero. 
- Age: Edad del pasajero.
- SibSp: Número de hermanos o conyuges a bordo del Titanic.
- Parch: Número de padres o niños a bordo del Titanic.
- Ticket: Número del ticket.
- Fare: Tarifa del pasajero (costo del ticket).
- Cabin: Número de cabina abordo del titanic.
- Embarked: Puerto de embarcación (C = Cherbourg, Q = Queenstown, S = Southampton)

# Importancia y objetivos de los análisis
Tomando en cuenta la informacion que nos provee el data set, el siguiente trabajo tratará de desarrollar un modelo de clasificacion supervisado XXXXXXXXX, que nos ayudará a predecir si un pasajero sobrevivió o no al hundimiento del Titanic, basado en sus atributos.
Este modelo nos ayudara a ratificar o contrastar las diferentes hipotesis que se deprenden en el analisis visual de los datos. 

# Limpieza de los datos
El primer paso para elaborar nuestro modelo de clasificaion es: la limpieza de los datos. En esta etapa vamos a aplicar las diferentes tecnicas de limpieza de datos que nos perimitirá corregir posibles inconsistencias, valores nulos y atributos innecesarios.

# Eliminación  de atributos 
Para cargar los datos en un data frame compatible con nuestro entorno, leemos el fichero de tipo .csv, utilizando la función *read.csv* de R. 

```{r message= FALSE, warning=FALSE}
passengers<-read.csv("./train.csv",header=T,sep=",")
```
Ahora utilizaremos la funcion *sapply*, que nos proporcionará el tipo de dato que maneja cada atributo.

```{r}
sapply(passengers, function(x) class(x))

```
Como podemos observar en la tabla superior, en nuestro data set podemos encontrar 3 tipos de datos: integer, character y numeric. 
Ahora procedemos a utilizar la funcion *summary* que nos ayudará con datos estadisticos generales de cada atributo.

```{r}
summary(passengers)
```
Como podemos observar, se obtiene la el minimo, la media y la mediana de todos los atributos de tipo integer y numeric. Ademas, en el atributo Age (Edad del pasajero) podemos observar un campo extra llamado NA´s. Este dato nos indica el numero de valores nulos o vacios que contienes este campo, en este caso 177.

Para la eliminacion de atributos innecesarios utilizaremos la funcion *str* de R que nos dara diferente ejemplos de cada atributo asi como su formato.

```{r}
str(passengers)
```
El primer atributo que se eliminará es: Passenger Id. Este atributo nos indica un numero asignado de manera incremetal a cada passajero por lo que no nos aporta informacion relevante para el analisi y entrenamiento del modelo.  El segundo atributo eliminado será Name, este atributo de tipo character al ser diferente para cada pasajero, no proporciona informacion util para la clasificacion. De la misma manera, el atributo ticket, da un valor alfanumerico especifico para cada pasajero por lo que tambien se eliminará. Por ultimo, despues de un analisis visual sobre el data set, se detecto un alto numero de valores nulos sobre el campo Cabin y los pocos registros con los que se cuenta dan un valor especifico por pasajero. 
Para eliminar los atributos mecionados, se procede a ejecutar lo siguiente:

```{r}
passengers$PassengerId<- NULL
passengers$Name <- NULL
passengers$Ticket <- NULL
passengers$Cabin <- NULL
```
## Normalizacion de datos
Como se pudo observar en el apartado anterior, solo contamos con un atributo (fare) de tipo numeric, que se puede normalizar para eliminar o disminuir grandes cambios debido a la diferencia entre valores del mismo atributo.

```{r}
passengers$Fare <- scale(passengers$Fare)
```
## Valores nulos
Ahora procederemos a tratar los valores nulos. 
Primero aplicamos el siguiente comando que nos ayudara a contabilizar los valores nulos de cada atributo:

```{r}
colSums(is.na(passengers))
```
Con la funcion is.na podmeos observar que el data set cuenta con varios datos vacios o nulos en el atributo Age (edad).
Debido al alto numero de valores nulos y a su alta relevancia para el analisis, vamos a analizar de manera detenida el atributo. 
Con el siguiente comando, vamos a ordenar los valores que toma el atributo basado en el numero de apariciones en el data set.


Como se puede observar, en la primera fila (los valores que mas se repiten), se encuentran valores en el rango de 20 a 30 años aproximadamente.
Para poder visualizar la infomracion de manera grafica, cargamos las librearias necesarias y procedemos a plotear la informacion con el siguiente comando:


```{r}
if(!require(ggplot2)){
    install.packages('ggplot2', repos='http://cran.us.r-project.org')
    library(ggplot2)
}
if(!require(ggpubr)){
    install.packages('ggpubr', repos='http://cran.us.r-project.org')
    library(ggpubr)
}
if(!require(grid)){
    install.packages('grid', repos='http://cran.us.r-project.org')
    library(grid)
}
if(!require(gridExtra)){
    install.packages('gridExtra', repos='http://cran.us.r-project.org')
    library(gridExtra)
}
if(!require(C50)){
    install.packages('C50', repos='http://cran.us.r-project.org')
    library(C50)
}

```




```{r}

ggplot(passengers, aes(cut(Age,10), fill = Sex)) + geom_bar()+ guides(x = guide_axis(angle = 90))+labs(x="Age", y="Pasenegers Number")

```
Como se puede observar en el gráfico, la mayor parte de pasajeros se encuentra distribuido en edades que van desde los 16.3 años hasta los 32.3. Ademas, podemos apreciar, el numero de hombres y mujeres mantiene la misma proporcion en los todos intervalos. Por esta razon, se procede a llenar los datos faltantes del atibuto edad con valores random en el intervalo con mayor numero de pasajeros, sin distincion si es hombre o mujer. 

Para reemplazar los valores nullos, primero creamos una columna con todos los valores 

```{r}
set.seed(873465)  
tmpAge <- passengers$Age
tmp <- passengers$Age[!is.na(passengers$Age)]  


passengers$Age[is.na(passengers$Age)]  <- sample(tmp, size = 177, replace = FALSE) 

```





```{r}
ggplot(passengers, aes(cut(Age,10), fill = Sex)) + geom_bar()+ guides(x = guide_axis(angle = 90))+labs(x="Age", y="Pasenegers Number")
ggplot(passengers, aes(cut(tmpAge,10), fill = Sex)) + geom_bar()+ guides(x = guide_axis(angle = 90))+labs(x="Age", y="Pasenegers Number")





```
Ahora procedemos a normalizar el atributo que contiene la tarifa del pasajero (Passenger Fare)




Transformacion de Box Cox
``
```{r}
library(missForest)
library(VIM)

passengers.mis <- prodNA(passengers, noNA = 0.1)
aggr(passengers.mis, numbers=TRUE, sortVars=TRUE, labels=names(passengers.mis), 
cex.axis=.7, gap=3, ylab=c("Missing data","Pattern"))






```

oOUtliers


```{r}
AgeOutliers<-boxplot(passengers$Age,main="Sepal Width")
FareOutliers<-boxplot(passengers$Fare,main="Sepal Width")


```


```{r}
plot(passengers$Fare)
```


```{r}
#Calcular outliers mas de 2 dvs

sd(passengers$Fare)
passengers.FareOutlier <- abs(passengers$Fare) > 3

#plot(passengers$Fare, pch=passengers.FareOutlier)


```




```{r}
#passengers.pca <- prcomp(passengers[,c(1:3,5:8)],na.rn=TRUE, center = TRUE, scale = TRUE)
#summary(passengers.pca)

```



